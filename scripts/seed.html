<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Seed Sample Training Events</title>
  <link rel="stylesheet" href="../assets/styles.css">
  <script>
    window.__FIREBASE_CONFIG = window.__FIREBASE_CONFIG || {
      apiKey: "YOUR_KEY",
      authDomain: "YOUR_APP.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      appId: "YOUR_APP_ID"
    };
  </script>
</head>
<body>
  <main class="layout" style="max-width: 640px; margin: 2rem auto;">
    <section class="details-panel" style="grid-column: 1 / -1;">
      <h1>Seed sample training events</h1>
      <p class="placeholder">This helper page is intended for Ossett Tigers U8 admins.</p>
      <div id="status" class="alert alert-info" role="status">Checking admin access…</div>
      <button id="seed-button" class="button" hidden>Seed sample training events</button>
    </section>
  </main>

  <script type="module" src="../src/firebase-deps.js"></script>
  <script type="module" src="../src/firebase.js"></script>
  <script type="module" src="../src/auth.js"></script>
  <script type="module" src="../src/dataModel.js"></script>
  <script type="module">
    const statusEl = document.getElementById('status');
    const seedButton = document.getElementById('seed-button');

    let adminUid = null;

    function setStatus(message, tone = 'info') {
      statusEl.textContent = message;
      statusEl.className = tone === 'error' ? 'alert' : 'alert alert-info';
      statusEl.setAttribute('role', tone === 'error' ? 'alert' : 'status');
    }

    function getUtcDate(daysAhead, hour) {
      const now = new Date();
      const target = new Date(Date.UTC(
        now.getUTCFullYear(),
        now.getUTCMonth(),
        now.getUTCDate() + daysAhead,
        hour,
        0,
        0,
        0
      ));
      return target;
    }

    async function seedEvents() {
      if (!adminUid) {
        setStatus('You must be signed in as an admin to seed events.', 'error');
        return;
      }

      seedButton.disabled = true;
      setStatus('Creating sample events…');

      const daysAhead = [2, 7, 12];
      const sessions = daysAhead.map((offset) => ({
        title: 'Ossett U8s Training',
        start: getUtcDate(offset, 18),
        end: getUtcDate(offset, 19),
        notes: 'Sample session generated by seeding script.',
        location: 'Ossett Academy',
        createdBy: adminUid,
      }));

      try {
        await Promise.all(sessions.map((session) => window.App.dataModel.createEvent(session)));
        setStatus('Created 3 upcoming Ossett U8s Training events.', 'info');
      } catch (error) {
        console.error(error);
        setStatus('Failed to seed events. See console for details.', 'error');
      } finally {
        seedButton.disabled = false;
      }
    }

    seedButton.addEventListener('click', seedEvents);

    window.App.auth.listenToAuth(async (user) => {
      if (!user) {
        adminUid = null;
        seedButton.hidden = true;
        setStatus('Please sign in on the main site before opening this page.', 'error');
        return;
      }

      const isAdmin = await window.App.dataModel.checkIfAdmin(user.uid);
      if (!isAdmin) {
        adminUid = null;
        seedButton.hidden = true;
        setStatus('Only admins can create events. Contact an admin for access.', 'error');
        return;
      }

      adminUid = user.uid;
      seedButton.hidden = false;
      seedButton.disabled = false;
      const name = user.displayName || user.email || 'admin';
      setStatus(`Signed in as ${name}. Click the button to seed sample training events.`);
    });
  </script>
</body>
</html>
